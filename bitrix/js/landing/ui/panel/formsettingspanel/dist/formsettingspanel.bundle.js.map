{"version":3,"file":"formsettingspanel.bundle.js","sources":["../src/formsettingspanel.js"],"sourcesContent":["import {BasePresetPanel, Preset, ContentWrapper, PresetCategory} from 'landing.ui.panel.basepresetpanel';\nimport {PageObject} from 'landing.pageobject';\nimport {Loc} from 'landing.loc';\nimport {Dom, Reflection, Runtime, Tag, Text, Type, Uri, Cache, Event} from 'main.core';\nimport type {BaseEvent} from 'main.core.events';\nimport {Backend} from 'landing.backend';\nimport {Loader} from 'main.loader';\nimport {FormClient} from 'crm.form.client';\nimport {Button} from 'ui.buttons';\nimport {Env} from 'landing.env';\nimport {StylePanel} from 'landing.ui.panel.stylepanel';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport type {FormDictionary, FormOptions} from 'crm.form.type';\nimport {Alert, AlertColor} from 'ui.alerts';\nimport {SidebarButton} from 'landing.ui.button.sidebarbutton';\nimport {Guide} from 'ui.tour';\nimport {FieldsPanel} from 'landing.ui.panel.fieldspanel';\nimport 'ui.switcher';\n\nimport './css/style.css';\n\ntype CrmField = {\n\ttype: 'list' | 'string' | 'checkbox' | 'date' | 'text' | 'typed_string' | 'file',\n\tentity_field_name: string,\n\tentity_name: string,\n\tname: string,\n\tcaption: string,\n\tmultiple: boolean,\n\trequired: boolean,\n\thidden: boolean,\n\titems: Array<{ID: any, VALUE: any}>,\n};\n\ntype CrmFieldsList = {\n\t[categoryId: string]: {\n\t\tCAPTION: string,\n\t\tFIELDS: Array<CrmField>\n\t},\n};\n\ntype CrmCompany = {\n\tID: string,\n\tTITLE: string,\n};\n\ntype CrmCategory = {\n\n};\n\n/**\n * @memberOf BX.Landing.UI.Panel\n */\nexport class FormSettingsPanel extends BasePresetPanel\n{\n\tstatic getInstance(): FormSettingsPanel\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst rootWindowPanel = rootWindow.BX.Landing.UI.Panel.FormSettingsPanel;\n\t\tif (!rootWindowPanel.instance && !FormSettingsPanel.instance)\n\t\t{\n\t\t\trootWindowPanel.instance = new FormSettingsPanel();\n\t\t}\n\n\t\treturn (rootWindowPanel.instance || FormSettingsPanel.instance);\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Landing.UI.Panel.FormSettingsPanel');\n\t\tthis.setTitle(Loc.getMessage('LANDING_FORM_SETTINGS_PANEL_TITLE'));\n\n\t\tthis.lsCache = new Cache.LocalStorageCache();\n\n\t\tthis.disableOverlay();\n\n\t\tif (this.isCrmFormPage())\n\t\t{\n\t\t\tconst {dictionary} = Env.getInstance().getOptions().formEditorData;\n\n\t\t\tconst preparedSidebarButtons = dictionary.sidebarButtons.map((buttonOptions) => {\n\t\t\t\treturn new SidebarButton({...buttonOptions, child: true});\n\t\t\t});\n\t\t\tthis.setSidebarButtons(preparedSidebarButtons);\n\n\t\t\tconst preparedPresets = dictionary.scenarios.map((presetOptions) => {\n\t\t\t\treturn new Preset(presetOptions);\n\t\t\t});\n\t\t\tthis.setPresets(preparedPresets);\n\n\t\t\tconst preparedPresetCategories = dictionary.scenarioCategories.map((categoryOptions) => {\n\t\t\t\treturn new PresetCategory(categoryOptions);\n\t\t\t});\n\t\t\tthis.setCategories(preparedPresetCategories);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(this.getBlockSettingsButton().render(), this.getRightHeaderControls());\n\t\t}\n\n\t\tthis.subscribe('onCancel', this.onCancelClick.bind(this));\n\n\t\tDom.append(this.getExpertSwitcherLayout(), this.layout);\n\t}\n\n\tgetExpertSwitcherLayout(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('switcherLayout', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tthis.getExpertModeSwitcher().node.click();\n\t\t\t};\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-expert-switcher\">\n\t\t\t\t\t${this.getExpertModeSwitcher().node}\n\t\t\t\t\t<span onclick=\"${onClick}\" class=\"landing-ui-expert-switcher-label\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_FORM_EXPERT_MODE_SWITCHER_LABEL')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetExpertModeSwitcher(): Switcher\n\t{\n\t\treturn this.cache.remember('expertModeSwitcher', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\tconst switcher = new rootWindow.BX.UI.Switcher({\n\t\t\t\tchecked: this.isExpertModeEnabled(),\n\t\t\t});\n\n\t\t\tDom.addClass(switcher.node, 'ui-switcher-size-sm ui-switcher-color-green');\n\n\t\t\tEvent.bind(switcher.node, 'click', this.onExpertSwitcherClick.bind(this));\n\n\t\t\treturn switcher;\n\t\t});\n\t}\n\n\tonExpertSwitcherClick()\n\t{\n\t\tthis.lsCache.set('formEditorExpertMode', this.getExpertModeSwitcher().isChecked());\n\t\tthis.onExpertModeChange();\n\t}\n\n\tgetCurrentPreset(): ?Preset\n\t{\n\t\tconst {templateId} = this.getFormOptions();\n\t\tconst preset = this.getPresets().find((currentPreset) => {\n\t\t\treturn currentPreset.options.id === templateId;\n\t\t});\n\n\t\tif (preset)\n\t\t{\n\t\t\treturn preset;\n\t\t}\n\n\t\treturn this.getPresets().find((currentPreset) => {\n\t\t\treturn currentPreset.options.id === 'expert';\n\t\t});\n\t}\n\n\tonExpertModeChange()\n\t{\n\t\tconst currentPreset = this.getCurrentPreset();\n\n\t\tif (\n\t\t\tthis.getExpertModeSwitcher().isChecked()\n\t\t\t&& Type.isArrayFilled(currentPreset.options.expertModeItems)\n\t\t)\n\t\t{\n\t\t\tthis.clearSidebar();\n\t\t\tthis.getSidebarButtons()\n\t\t\t\t.filter((button) => {\n\t\t\t\t\treturn currentPreset.options.expertModeItems.includes(button.id);\n\t\t\t\t})\n\t\t\t\t.forEach((button) => {\n\t\t\t\t\tif (!currentPreset.options.items.includes(button.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tbutton.deactivate();\n\t\t\t\t\t}\n\t\t\t\t\tthis.appendSidebarButton(button);\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentSidebarButton = this.getSidebarButtons().find((button) => {\n\t\t\t\treturn button.isActive();\n\t\t\t});\n\n\t\t\tconst buttons = this.getSidebarButtons().filter((button) => {\n\t\t\t\treturn currentPreset.options.items.includes(button.id);\n\t\t\t});\n\n\t\t\tthis.clearSidebar();\n\t\t\tbuttons.forEach((button) => {\n\t\t\t\tthis.appendSidebarButton(button);\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\tcurrentSidebarButton\n\t\t\t\t&& !currentPreset.options.items.includes(currentSidebarButton.id)\n\t\t\t)\n\t\t\t{\n\t\t\t\tconst defaultSection = (() => {\n\t\t\t\t\tif (Type.isStringFilled(currentPreset.options.defaultSection))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn currentPreset.options.defaultSection;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn 'fields';\n\t\t\t\t})();\n\n\t\t\t\tconst defaultSectionButton = this.getSidebarButtons().find((button) => {\n\t\t\t\t\treturn button.id === defaultSection;\n\t\t\t\t});\n\n\t\t\t\tif (defaultSectionButton)\n\t\t\t\t{\n\t\t\t\t\tdefaultSectionButton.getLayout().click();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tisExpertModeEnabled(): boolean\n\t{\n\t\treturn this.lsCache.get('formEditorExpertMode', false);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tisCrmFormPage(): boolean\n\t{\n\t\treturn Env.getInstance().getOptions().specialType === 'crm_forms';\n\t}\n\n\tgetFormDesignButton()\n\t{\n\t\treturn this.cache.remember('formDesignButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('LANDING_FORM_DESIGN_BUTTON'),\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\tround: true,\n\t\t\t\tclassName: 'landing-ui-panel-top-button',\n\t\t\t\tonclick: this.onFormDesignButtonClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetBlockSettingsButton()\n\t{\n\t\treturn this.cache.remember('blockSettingsButton', () => {\n\t\t\treturn new Button({\n\t\t\t\ttext: Loc.getMessage('LANDING_FORM_SETTINGS_BLOCK_SETTINGS_BUTTON_TEXT'),\n\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\tround: true,\n\t\t\t\tclassName: 'landing-ui-panel-top-button',\n\t\t\t\tonclick: this.onBlockSettingsButtonClick.bind(this),\n\t\t\t});\n\t\t});\n\t}\n\n\tonBlockSettingsButtonClick()\n\t{\n\t\tif (this.getCurrentBlock())\n\t\t{\n\t\t\tthis.hide()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.getCurrentBlock().showContentPanel();\n\t\t\t\t});\n\t\t}\n\t}\n\n\tonFormDesignButtonClick()\n\t{\n\t\tif (this.getCurrentBlock())\n\t\t{\n\t\t\tthis.getCurrentBlock().onFormDesignClick();\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\treturn this.cache.remember('loader', () => {\n\t\t\treturn new Loader({\n\t\t\t\ttarget: this.body,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tDom.addClass(this.layout, 'landing-ui-panel-state-content-load');\n\t\tvoid this.getLoader().show();\n\t\tDom.hide(this.sidebar);\n\t\tDom.hide(this.content);\n\t\tDom.hide(this.getExpertSwitcherLayout());\n\t}\n\n\thideLoader()\n\t{\n\t\tDom.removeClass(this.layout, 'landing-ui-panel-state-content-load');\n\t\tthis.getLoader().hide();\n\t\tDom.show(this.sidebar);\n\t\tDom.show(this.content);\n\n\t\tif (Type.isArrayFilled(this.getCurrentPreset().options.expertModeItems))\n\t\t{\n\t\t\tDom.show(this.getExpertSwitcherLayout());\n\t\t}\n\t}\n\n\tshowContentLoader()\n\t{\n\t\tDom.addClass(this.layout, 'landing-ui-panel-state-body-load');\n\t\tsuper.showContentLoader();\n\t}\n\n\thideContentLoader()\n\t{\n\t\tDom.removeClass(this.layout, 'landing-ui-panel-state-body-load');\n\t\tsuper.hideContentLoader();\n\t}\n\n\tload(options = {}): Promise<any>\n\t{\n\t\tif (options.showWithOptions)\n\t\t{\n\t\t\tconst editorData = Env.getInstance().getOptions().formEditorData;\n\t\t\tconst {dictionary} = editorData;\n\n\t\t\tconst preparedSidebarButtons = dictionary.sidebarButtons.map((buttonOptions) => {\n\t\t\t\treturn new SidebarButton({...buttonOptions, child: true});\n\t\t\t});\n\t\t\tthis.setSidebarButtons(preparedSidebarButtons);\n\n\t\t\tconst preparedPresets = dictionary.scenarios.map((presetOptions) => {\n\t\t\t\treturn new Preset(presetOptions);\n\t\t\t});\n\t\t\tthis.setPresets(preparedPresets);\n\n\t\t\tconst preparedPresetCategories = dictionary.scenarioCategories.map((categoryOptions) => {\n\t\t\t\treturn new PresetCategory(categoryOptions);\n\t\t\t});\n\t\t\tthis.setCategories(preparedPresetCategories);\n\n\t\t\tthis.setCrmFields(editorData.crmFields);\n\t\t\tthis.setCrmCompanies(editorData.crmCompanies);\n\t\t\tthis.setCrmCategories(editorData.crmCategories);\n\t\t\tthis.setAgreements(editorData.agreements);\n\n\t\t\tconst currentOptions = Runtime.clone(editorData.formOptions);\n\t\t\tif (currentOptions.agreements.use !== true)\n\t\t\t{\n\t\t\t\tcurrentOptions.agreements.use = true;\n\t\t\t\tcurrentOptions.data.agreements = [];\n\t\t\t}\n\n\t\t\tthis.setFormOptions(currentOptions);\n\t\t\tthis.setFormDictionary(editorData.dictionary);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst crmData = Backend.getInstance()\n\t\t\t.batch('Form::getCrmFields', {\n\t\t\t\tcrmFields: {\n\t\t\t\t\taction: 'Form::getCrmFields',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t\tcrmCompanies: {\n\t\t\t\t\taction: 'Form::getCrmCompanies',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t\tcrmCategories: {\n\t\t\t\t\taction: 'Form::getCrmCategories',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t\tagreements: {\n\t\t\t\t\taction: 'Form::getAgreements',\n\t\t\t\t\tdata: null,\n\t\t\t\t},\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tthis.setCrmFields(result.crmFields.result);\n\t\t\t\tthis.setCrmCompanies(result.crmCompanies.result);\n\t\t\t\tthis.setCrmCategories(result.crmCategories.result);\n\t\t\t\tthis.setAgreements(result.agreements.result);\n\t\t\t});\n\n\t\tconst formOptions = FormClient.getInstance()\n\t\t\t.getOptions(this.getCurrentFormId())\n\t\t\t.then((options) => {\n\t\t\t\tconst currentOptions = Runtime.clone(options);\n\t\t\t\tif (currentOptions.agreements.use !== true)\n\t\t\t\t{\n\t\t\t\t\tcurrentOptions.agreements.use = true;\n\t\t\t\t\tcurrentOptions.data.agreements = [];\n\t\t\t\t}\n\n\t\t\t\tthis.setFormOptions(currentOptions);\n\t\t\t});\n\n\t\tconst formDictionary = FormClient.getInstance()\n\t\t\t.getDictionary()\n\t\t\t.then((dictionary) => {\n\t\t\t\tthis.setFormDictionary(dictionary);\n\n\t\t\t\tconst preparedSidebarButtons = dictionary.sidebarButtons.map((buttonOptions) => {\n\t\t\t\t\treturn new SidebarButton({...buttonOptions, child: true});\n\t\t\t\t});\n\t\t\t\tthis.setSidebarButtons(preparedSidebarButtons);\n\n\t\t\t\tconst preparedPresets = dictionary.scenarios.map((presetOptions) => {\n\t\t\t\t\treturn new Preset(presetOptions);\n\t\t\t\t});\n\t\t\t\tthis.setPresets(preparedPresets);\n\n\t\t\t\tconst preparedPresetCategories = dictionary.scenarioCategories.map((categoryOptions) => {\n\t\t\t\t\treturn new PresetCategory(categoryOptions);\n\t\t\t\t});\n\t\t\t\tthis.setCategories(preparedPresetCategories);\n\t\t\t});\n\n\t\treturn Promise.all([\n\t\t\tcrmData,\n\t\t\tformOptions,\n\t\t\tformDictionary,\n\t\t]);\n\t}\n\n\tsetAgreements(agreements)\n\t{\n\t\tthis.cache.set('agreements', Runtime.orderBy(agreements, ['id'], ['asc']));\n\t}\n\n\tgetAgreements(): Array<{[key: string]: any}>\n\t{\n\t\treturn this.cache.get('agreements');\n\t}\n\n\tisLeadEnabled(): boolean\n\t{\n\t\treturn this.getFormDictionary().document.lead.enabled;\n\t}\n\n\tsetCurrentBlock(block: BX.Landing.Block)\n\t{\n\t\tthis.cache.set('currentBlock', block);\n\t}\n\n\tgetCurrentBlock(): ?BX.Landing.Block\n\t{\n\t\treturn this.cache.get('currentBlock');\n\t}\n\n\tgetSaveOriginalFileNameAlert(): HTMLElement\n\t{\n\t\treturn this.cache.remember('saveOriginalFileNameAlert', () => {\n\t\t\tconst alert = new Alert({\n\t\t\t\ttext: Loc.getMessage('LANDING_CRM_FORM_MAIN_OPTION_WARNING'),\n\t\t\t\tcolor: AlertColor.WARNING,\n\t\t\t});\n\n\t\t\treturn alert.render();\n\t\t});\n\t}\n\n\tshow(\n\t\toptions: {\n\t\t\tformId: number,\n\t\t\tinstanceId: number,\n\t\t\tstate?: 'presets',\n\t\t\tformOptions?: ?{[key: string]: any},\n\t\t\tshowWithOptions: true,\n\t\t} = {\n\t\t\tformOptions: {},\n\t\t},\n\t): Promise<any>\n\t{\n\t\tif (!this.layout.parentNode)\n\t\t{\n\t\t\tthis.enableToggleMode();\n\t\t}\n\n\t\tif (!this.isFormCreated())\n\t\t{\n\t\t\tthis.disableTransparentMode();\n\t\t}\n\n\t\tconst {mainOptions} = Env.getInstance().getOptions();\n\t\tif (mainOptions.saveOriginalFileName === false)\n\t\t{\n\t\t\tthis.prependContent(\n\t\t\t\tthis.getSaveOriginalFileNameAlert(),\n\t\t\t);\n\n\t\t\tconst closeButtonTop = Text.toNumber(Dom.style(this.closeButton.getLayout(), 'top'));\n\t\t\tconst alertHeight = this.getSaveOriginalFileNameAlert().getBoundingClientRect().height;\n\n\t\t\tDom.style(this.closeButton.getLayout(), 'top', `${closeButtonTop + alertHeight}px`);\n\t\t}\n\n\t\tthis.setCurrentBlock(options.block);\n\t\tthis.setCurrentFormId(options.formId);\n\t\tthis.setCurrentFormInstanceId(options.instanceId);\n\n\t\tthis.showLoader();\n\n\t\tthis.load(options)\n\t\t\t.then(() => {\n\t\t\t\tthis.hideLoader();\n\n\t\t\t\tconst formOptions = this.getFormOptions();\n\t\t\t\tif (Type.isPlainObject(options.formOptions))\n\t\t\t\t{\n\t\t\t\t\tconst formOptions = Runtime.merge(\n\t\t\t\t\t\tthis.getFormOptions(),\n\t\t\t\t\t\toptions.formOptions,\n\t\t\t\t\t);\n\t\t\t\t\tthis.setFormOptions(formOptions);\n\t\t\t\t}\n\n\t\t\t\tif (options.state === 'presets')\n\t\t\t\t{\n\t\t\t\t\tconst presetFromRequest = this.getPresetIdFromRequest();\n\t\t\t\t\tlet preset = false;\n\n\t\t\t\t\tif (presetFromRequest)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreset = this.getPresets().find((item) => {\n\t\t\t\t\t\t\treturn item.options.id === presetFromRequest;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (preset)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.applyPreset(preset);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onPresetFieldClick();\n\t\t\t\t\t\tthis.activatePreset(formOptions.templateId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet preset = this.getPresets().find((item) => {\n\t\t\t\t\t\treturn item.options.id === formOptions.templateId;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!preset)\n\t\t\t\t\t{\n\t\t\t\t\t\tpreset = this.getPresets().find((item) => {\n\t\t\t\t\t\t\treturn item.options.id === 'expert';\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isFormCreated())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.applyPreset(preset);\n\t\t\t\t\t\tthis.onPresetFieldClick();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.applyPreset(preset, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.setInitialFormOptions(\n\t\t\t\t\tRuntime.clone(this.getFormOptions()),\n\t\t\t\t);\n\n\t\t\t\tif (!this.isFormCreated())\n\t\t\t\t{\n\t\t\t\t\tthis.onExpertModeChange();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (Type.isArrayFilled(error))\n\t\t\t\t{\n\t\t\t\t\tconst accessDeniedCode = 510;\n\t\t\t\t\tconst isAccessDenied = error.some((errorItem) => {\n\t\t\t\t\t\treturn String(errorItem.code) === String(accessDeniedCode);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (isAccessDenied)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getLoader().hide();\n\t\t\t\t\t\tDom.show(this.sidebar);\n\t\t\t\t\t\tDom.show(this.content);\n\t\t\t\t\t\tDom.hide(this.footer);\n\t\t\t\t\t\tDom.append(this.getAccessError(), this.content);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\n\t\tconst editorWindow = PageObject.getEditorWindow();\n\t\tDom.addClass(editorWindow.document.body, 'landing-ui-hide-action-panels-form');\n\n\t\tvoid StylePanel.getInstance().hide();\n\n\t\treturn super.show(options).then(() => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getCurrentBlock().node.scrollIntoView({behavior: 'smooth'});\n\t\t\t}, 300);\n\n\t\t\treturn Promise.resolve(true);\n\t\t});\n\t}\n\n\tgetAccessError(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('accessErrorMessage', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"landing-ui-access-error-message\">\n\t\t\t\t\t<div class=\"landing-ui-access-error-message-text\">\n\t\t\t\t\t\t${Loc.getMessage('LANDING_CRM_ACCESS_ERROR_MESSAGE')}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tgetPresetIdFromRequest(): ?string\n\t{\n\t\tconst uri = new Uri(window.top.location.href);\n\t\treturn uri.getQueryParam('preset');\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tisFormCreated(): boolean\n\t{\n\t\tconst rootWindow = PageObject.getRootWindow();\n\t\tconst uri = new Uri(rootWindow.location.href);\n\t\treturn Text.toBoolean(uri.getQueryParam('formCreated'));\n\t}\n\n\tsetCurrentFormId(formId: number)\n\t{\n\t\tthis.cache.set('currentFormId', Text.toNumber(formId));\n\t}\n\n\tgetCurrentFormId(): number\n\t{\n\t\treturn this.cache.get('currentFormId');\n\t}\n\n\tsetCurrentFormInstanceId(formId: number)\n\t{\n\t\tthis.cache.set('currentFormInstanceId', formId);\n\t}\n\n\tgetCurrentFormInstanceId(): number\n\t{\n\t\treturn this.cache.get('currentFormInstanceId');\n\t}\n\n\tsetCrmFields(fields)\n\t{\n\t\tthis.cache.set('fields', fields);\n\t}\n\n\tgetCrmFields(): CrmFieldsList\n\t{\n\t\treturn this.cache.get('fields') || {};\n\t}\n\n\tsetCrmCompanies(companies: Array<CrmCompany>)\n\t{\n\t\tthis.cache.set('companies', companies);\n\t}\n\n\tgetCrmCompanies(): Array<CrmCompany>\n\t{\n\t\treturn this.cache.get('companies') || [];\n\t}\n\n\tsetCrmCategories(categories: Array<CrmCategory>)\n\t{\n\t\tthis.cache.set('crmCategories', categories);\n\t}\n\n\tgetCrmCategories(): Array<CrmCategory>\n\t{\n\t\treturn this.cache.get('crmCategories') || [];\n\t}\n\n\tsetFormOptions(options: FormOptions)\n\t{\n\t\tthis.cache.set('formOptions', options);\n\t}\n\n\tgetFormOptions(): FormOptions\n\t{\n\t\treturn Runtime.clone(this.cache.get('formOptions') || {});\n\t}\n\n\tsetFormDictionary(dictionary: FormDictionary)\n\t{\n\t\tthis.cache.set('formDictionary', dictionary);\n\t}\n\n\tgetFormDictionary(): FormDictionary\n\t{\n\t\treturn this.cache.get('formDictionary') || {};\n\t}\n\n\tsetInitialFormOptions(options: FormOptions)\n\t{\n\t\tthis.cache.set('initialFormOptions', Runtime.clone(options));\n\t}\n\n\tgetInitialFormOptions(): FormOptions\n\t{\n\t\treturn this.cache.get('initialFormOptions');\n\t}\n\n\t// eslint-disable-next-line\n\tgetCrmForm()\n\t{\n\t\tconst formApp = Reflection.getClass('b24form.App');\n\t\tif (formApp)\n\t\t{\n\t\t\tif (this.getCurrentFormInstanceId())\n\t\t\t{\n\t\t\t\treturn formApp.get(this.getCurrentFormInstanceId());\n\t\t\t}\n\n\t\t\tlet tmpIndex = -1;\n\t\t\tconst currentFormIndex = [\n\t\t\t\t...this.getCurrentBlock().node.parentElement.childNodes,\n\t\t\t].reduce((acc, item) => {\n\t\t\t\tif (Dom.attr(item, 'data-subtype') === 'form')\n\t\t\t\t{\n\t\t\t\t\ttmpIndex += 1;\n\t\t\t\t\tif (item === this.getCurrentBlock().node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn tmpIndex;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, 0);\n\n\t\t\treturn formApp.list()[currentFormIndex];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonChange(event: BaseEvent)\n\t{\n\t\tconst eventData = event.getData();\n\t\tconst eventTargetValue = event.getTarget().getValue();\n\n\t\tPromise\n\t\t\t.resolve(eventTargetValue)\n\t\t\t.then((value) => {\n\t\t\t\tif (eventData.skipPrepare)\n\t\t\t\t{\n\t\t\t\t\tconst formOptions = this.getFormOptions();\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tReflect.has(value, 'presetFields')\n\t\t\t\t\t\t|| Reflect.has(value, 'document')\n\t\t\t\t\t\t|| Reflect.has(value, 'result')\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst additionalValue = {};\n\t\t\t\t\t\tif (Reflect.has(value, 'document'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tadditionalValue.payment = value.document.payment;\n\t\t\t\t\t\t\tdelete value.document.payment;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...formOptions,\n\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t...additionalValue,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tReflect.has(value, 'embedding')\n\t\t\t\t\t\t|| Reflect.has(value, 'callback')\n\t\t\t\t\t\t|| Reflect.has(value, 'whatsapp')\n\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\tReflect.has(value, 'name')\n\t\t\t\t\t\t\t&& Reflect.has(value, 'data')\n\t\t\t\t\t\t\t&& Reflect.has(value.data, 'useSign')\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst mergedOptions = Runtime.merge(\n\t\t\t\t\t\t\tformOptions,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (Reflect.has(value, 'responsible'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmergedOptions.responsible.users = value.responsible.users;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn mergedOptions;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Reflect.has(value, 'recaptcha'))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst {key, secret} = value.recaptcha;\n\t\t\t\t\t\tdelete value.recaptcha.key;\n\t\t\t\t\t\tdelete value.recaptcha.secret;\n\t\t\t\t\t\tconst captcha = {};\n\n\t\t\t\t\t\tif (!Type.isNil(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaptcha.key = key;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!Type.isNil(secret))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaptcha.secret = secret;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...formOptions,\n\t\t\t\t\t\t\tcaptcha: {\n\t\t\t\t\t\t\t\t...formOptions.captcha,\n\t\t\t\t\t\t\t\t...captcha,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t...formOptions.data,\n\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...formOptions,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t...formOptions.data,\n\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn FormClient.getInstance()\n\t\t\t\t\t.prepareOptions(this.getFormOptions(), value)\n\t\t\t\t\t.then(result => {\n\t\t\t\t\t\tif (value.agreements)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.data = Runtime.merge(result.data, value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value.integration)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.integration = value.integration;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (value.fields)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresult.data.fields = result.data.fields.map((field, index) => {\n\t\t\t\t\t\t\t\treturn Runtime.merge(field, value.fields[index]);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tBX.Landing.UI.Panel.Top\n\t\t\t\t\t.getInstance()\n\t\t\t\t\t.setFormName(result.name);\n\t\t\t\tthis.setFormOptions(result);\n\t\t\t\tthis.getCrmForm().adjust(Runtime.clone(result.data));\n\t\t\t});\n\t}\n\n\tstatic sanitize(value: any): any\n\t{\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\treturn Text.decode(value)\n\t\t\t\t.replace(/<style[^>]*>.*<\\/style>/gm, '')\n\t\t\t\t.replace(/<script[^>]*>.*<\\/script>/gm, '')\n\t\t\t\t.replace(/<[^>]+>/gm, '');\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tgetPersonalizationVariables(): Array<{name: string, value: string}>\n\t{\n\t\treturn this.cache.remember('personalizationVariables', () => {\n\t\t\treturn this.getFormDictionary().personalization.list.map((item) => {\n\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDefaultValuesVariables(): Array<{name: string, value: string}>\n\t{\n\t\treturn this.cache.remember('personalizationVariables', () => {\n\t\t\tconst {properties} = this.getFormDictionary();\n\t\t\tif (Type.isPlainObject(properties) && Type.isArrayFilled(properties.list))\n\t\t\t{\n\t\t\t\treturn properties.list.map((item) => {\n\t\t\t\t\treturn {name: item.name, value: item.id};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\t}\n\n\tgetContent(id: string): Promise<ContentWrapper>\n\t{\n\t\tconst currentButton = this.getSidebarButtons().find((button) => {\n\t\t\treturn id === button.options.id;\n\t\t});\n\n\t\tconst {extension} = currentButton.options.data;\n\n\t\tconst contentExtension = this.cache.remember(extension, () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn rootWindow.BX.Runtime\n\t\t\t\t.loadExtension(extension)\n\t\t\t\t.then((exports) => {\n\t\t\t\t\treturn exports.default;\n\t\t\t\t});\n\t\t});\n\n\t\treturn contentExtension.then((ContentWrapperClass) => {\n\t\t\tif (Type.isFunction(ContentWrapperClass))\n\t\t\t{\n\t\t\t\treturn new ContentWrapperClass({\n\t\t\t\t\tformOptions: this.getFormOptions(),\n\t\t\t\t\tdictionary: this.getFormDictionary(),\n\t\t\t\t\tcrmFields: this.getCrmFields(),\n\t\t\t\t\tcompanies: this.getCrmCompanies(),\n\t\t\t\t\tcategories: this.getCrmCategories(),\n\t\t\t\t\tagreements: this.getAgreements(),\n\t\t\t\t\tisLeadEnabled: this.isLeadEnabled(),\n\t\t\t\t\tform: this.getCrmForm(),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tonPresetClick(event: BaseEvent)\n\t{\n\t\tif (event.getTarget().options.openable)\n\t\t{\n\t\t\tthis.disableTransparentMode();\n\t\t}\n\n\t\tconst uri = new Uri(window.top.location.toString());\n\t\turi.removeQueryParam('formCreated');\n\t\turi.removeQueryParam('preset');\n\t\twindow.top.history.replaceState(null, document.title, uri.toString());\n\n\t\tthis.applyPreset(event.getTarget());\n\t}\n\n\tgetCheckActionConfirm(): MessageBox\n\t{\n\t\treturn this.cache.remember('checkActionConfirm', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.UI.Dialogs.MessageBox({\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t});\n\t}\n\n\tapplyPreset(preset: Preset, skipOptions = false)\n\t{\n\t\tconst lastPreset = this.getPresets().find((currentPreset: Preset) => {\n\t\t\treturn Dom.hasClass(currentPreset.getLayout(), 'landing-ui-panel-preset-active');\n\t\t});\n\n\t\tthis.getPresets().forEach((currentPreset) => {\n\t\t\tcurrentPreset.deactivate();\n\t\t});\n\n\t\tif (!skipOptions)\n\t\t{\n\t\t\tconst runAction = (() => {\n\t\t\t\tif (Type.isArrayFilled(preset.options.actions))\n\t\t\t\t{\n\t\t\t\t\treturn Promise.all(\n\t\t\t\t\t\tpreset.options.actions.map((action) => {\n\t\t\t\t\t\t\tif (action.id === 'showTour')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\t\t\t\t\tconst guide = new rootWindow.BX.UI.Tour.Guide({\n\t\t\t\t\t\t\t\t\tonEvents: false,\n\t\t\t\t\t\t\t\t\tsteps: action.data.steps,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tguide.start();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (action.id === 'showHelp')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (window.top.BX.Helper)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\twindow.top.BX.Helper.show(action.data.href);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (action.id === 'check')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn FormClient\n\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t.check({\n\t\t\t\t\t\t\t\t\t\ttemplateId: preset.options.id,\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\t\tif (result.success === false)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tconst checkActionConfirm = this.getCheckActionConfirm();\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setTitle(result.message.title);\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setMessage(result.message.description);\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setOkCaption(result.message.confirmButton);\n\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setCancelCaption(result.message.cancelButton);\n\n\t\t\t\t\t\t\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setOkCallback(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getCancelButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.setCancelCallback(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getOkButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.getCancelButton().setDisabled(false);\n\t\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\tcheckActionConfirm.show();\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn Promise.resolve(true);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve();\n\t\t\t})();\n\n\t\t\tif (preset.options.openable)\n\t\t\t{\n\t\t\t\tthis.showLoader();\n\n\t\t\t\tvoid runAction\n\t\t\t\t\t.then((actions) => {\n\t\t\t\t\t\tconst actionsResult = (() => {\n\t\t\t\t\t\t\tif (Type.isArrayFilled(preset.options.actions))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn preset.options.actions.reduce((acc, item, index) => {\n\t\t\t\t\t\t\t\t\treturn {...acc, [item.id]: actions[index]};\n\t\t\t\t\t\t\t\t}, {});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn {};\n\t\t\t\t\t\t})();\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tReflect.has(actionsResult, 'check')\n\t\t\t\t\t\t\t\t&& actionsResult.check === true\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t|| (\n\t\t\t\t\t\t\t\t!Reflect.has(actionsResult, 'check')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getPresets().forEach((currentPreset) => {\n\t\t\t\t\t\t\t\tcurrentPreset.deactivate();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tpreset.activate();\n\n\t\t\t\t\t\t\tFormClient.getInstance()\n\t\t\t\t\t\t\t\t.prepareOptions(this.getFormOptions(), {templateId: preset.options.id})\n\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\treturn Backend.getInstance()\n\t\t\t\t\t\t\t\t\t\t.action('Form::getCrmFields')\n\t\t\t\t\t\t\t\t\t\t.then((crmFields) => {\n\t\t\t\t\t\t\t\t\t\t\tthis.setCrmFields(crmFields);\n\t\t\t\t\t\t\t\t\t\t\tFieldsPanel.getInstance().setCrmFields(crmFields);\n\t\t\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\t\t\tBX.Landing.UI.Panel.Top\n\t\t\t\t\t\t\t\t\t\t.getInstance()\n\t\t\t\t\t\t\t\t\t\t.setFormName(result.name);\n\t\t\t\t\t\t\t\t\tthis.setFormOptions({\n\t\t\t\t\t\t\t\t\t\t...result,\n\t\t\t\t\t\t\t\t\t\ttemplateId: preset.options.id,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.getCrmForm().adjust(Runtime.clone(result.data));\n\t\t\t\t\t\t\t\t\tif (this.isFormCreated())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.onPresetFieldClick();\n\t\t\t\t\t\t\t\t\t\tthis.activatePreset(preset.options.id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsuper.applyPreset(preset);\n\n\t\t\t\t\t\t\t\t\t\tif (Type.isArrayFilled(preset.options.expertModeItems))\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tDom.show(this.getExpertSwitcherLayout());\n\t\t\t\t\t\t\t\t\t\t\tthis.onExpertModeChange();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tDom.hide(this.getExpertSwitcherLayout());\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t\t\tthis.enableTransparentMode();\n\n\t\t\t\t\t\t\tif (lastPreset)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlastPreset.activate();\n\t\t\t\t\t\t\t\tpreset.deactivate();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (preset.options.openable)\n\t\t\t{\n\t\t\t\tsuper.applyPreset(preset);\n\t\t\t\tif (Type.isArrayFilled(preset.options.expertModeItems))\n\t\t\t\t{\n\t\t\t\t\tDom.show(this.getExpertSwitcherLayout());\n\t\t\t\t\tthis.onExpertModeChange();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.hide(this.getExpertSwitcherLayout());\n\t\t\t\t}\n\t\t\t\tthis.hideLoader();\n\t\t\t}\n\n\t\t\tpreset.activate();\n\t\t}\n\t}\n\n\tgetFormNode(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('formNode', () => {\n\t\t\treturn this.getCurrentBlock().node.querySelector('[data-b24form-use-style]');\n\t\t});\n\t}\n\n\tuseBlockDesign(): boolean\n\t{\n\t\treturn this.cache.remember('useBlockDesign', () => {\n\t\t\treturn Text.toBoolean(Dom.attr(this.getFormNode(), 'data-b24form-use-style'));\n\t\t});\n\t}\n\n\tgetCurrentCrmEntityName(): string\n\t{\n\t\tconst {scheme} = this.getFormOptions().document;\n\t\tconst schemeItem = this.getFormDictionary().document.schemes.find((item) => {\n\t\t\treturn String(scheme) === String(item.id);\n\t\t});\n\n\t\treturn schemeItem.name;\n\t}\n\n\tgetNotSynchronizedFields(): Promise<any>\n\t{\n\t\treturn FormClient\n\t\t\t.getInstance()\n\t\t\t.checkFields(this.getFormOptions())\n\t\t\t.then((result) => {\n\t\t\t\treturn result;\n\t\t\t});\n\t}\n\n\tshowSynchronizationPopup(notSynchronizedFields: Array<string>): Promise<boolean>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tconst onOk = (messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tresolve(true);\n\t\t\t};\n\n\t\t\tconst onCancel = (messageBox: MessageBox) => {\n\t\t\t\tmessageBox.close();\n\t\t\t\tresolve(false);\n\t\t\t};\n\n\t\t\tconst messageDescription = (() => {\n\t\t\t\tconst entityName = Loc.getMessage('LANDING_SYNCHRONIZATION_POPUP_ENTITY_TEMPLATE')\n\t\t\t\t\t.replace('{entityName}', Text.encode(this.getCurrentCrmEntityName()));\n\n\t\t\t\treturn Loc.getMessage('LANDING_SYNCHRONIZATION_POPUP_DESCRIPTION')\n\t\t\t\t\t.replace('{entityName}', Text.encode(entityName));\n\t\t\t})();\n\n\t\t\tconst messageText = (() => {\n\t\t\t\tconst fields = [...notSynchronizedFields].map((field) => {\n\t\t\t\t\treturn Loc.getMessage('LANDING_SYNCHRONIZATION_POPUP_FIELD_TEMPLATE')\n\t\t\t\t\t\t.replace('{fieldName}', Text.encode(field));\n\t\t\t\t});\n\n\t\t\t\tif (notSynchronizedFields.length > 1)\n\t\t\t\t{\n\t\t\t\t\tconst lastField = fields.pop();\n\n\t\t\t\t\treturn Loc\n\t\t\t\t\t\t.getMessage('LANDING_SYNCHRONIZATION_POPUP_TEXT')\n\t\t\t\t\t\t.replace('{fieldsList}', fields.join(', '))\n\t\t\t\t\t\t.replace('{lastField}', lastField);\n\t\t\t\t}\n\n\t\t\t\treturn Loc\n\t\t\t\t\t.getMessage('LANDING_SYNCHRONIZATION_POPUP_TEXT_1')\n\t\t\t\t\t.replace('{field}', fields.join(', '));\n\t\t\t})();\n\n\t\t\twindow.top.BX.UI.Dialogs.MessageBox.confirm(\n\t\t\t\t`${messageDescription}<br><br>${messageText}`,\n\t\t\t\tLoc.getMessage('LANDING_SYNCHRONIZATION_POPUP_TITLE'),\n\t\t\t\tonOk,\n\t\t\t\tLoc.getMessage('LANDING_SYNCHRONIZATION_POPUP_OK_BUTTON_LABEL'),\n\t\t\t\tonCancel,\n\t\t\t);\n\t\t});\n\t}\n\n\tshowSynchronizationErrorPopup(errors: Array<string>)\n\t{\n\t\tconst message = errors.reduce((acc, item) => {\n\t\t\treturn `${acc}\\n\\n${item}`;\n\t\t}, '');\n\n\t\twindow.top.BX.UI.Dialogs.MessageBox.alert(message);\n\t}\n\n\tgetErrorAlert(): MessageBox\n\t{\n\t\treturn this.cache.remember('errorAlert', () => {\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\treturn new rootWindow.BX.UI.Dialogs.MessageBox({\n\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SAVE_ERROR_ALERT_TITLE'),\n\t\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tmaxHeight: 310,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tonSaveClick()\n\t{\n\t\tconst dictionary = this.getFormDictionary();\n\n\t\tif (\n\t\t\tType.isPlainObject(dictionary.permissions)\n\t\t\t&& Type.isPlainObject(dictionary.permissions.form)\n\t\t\t&& dictionary.permissions.form.edit === false\n\t\t)\n\t\t{\n\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\trootWindow.BX.UI.Dialogs.MessageBox.alert(Loc.getMessage('LANDING_FORM_SAVE_PERMISSION_DENIED'));\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.getSaveButton().layout, 'ui-btn-wait');\n\n\t\tthis.getNotSynchronizedFields()\n\t\t\t.then((result) => {\n\t\t\t\tif (Type.isPlainObject(result.sync))\n\t\t\t\t{\n\t\t\t\t\tif (Type.isArrayFilled(result.sync.errors))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showSynchronizationErrorPopup(result.sync.errors);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isArrayFilled(result.sync.fields))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst fieldLabels = result.sync.fields.map((field) => {\n\t\t\t\t\t\t\treturn field.label;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this.showSynchronizationPopup(fieldLabels);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.then((isConfirmed) => {\n\t\t\t\tif (isConfirmed)\n\t\t\t\t{\n\t\t\t\t\tconst uri = new Uri(window.top.location.toString());\n\t\t\t\t\turi.removeQueryParam('formCreated');\n\t\t\t\t\twindow.top.history.replaceState(null, document.title, uri.toString());\n\n\t\t\t\t\tconst initialOptions = this.getInitialFormOptions();\n\t\t\t\t\tconst currentOptions = this.getFormOptions();\n\t\t\t\t\tconst options = (() => {\n\t\t\t\t\t\tif (!this.isCrmFormPage())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst clonedOptions = Runtime.clone(currentOptions);\n\t\t\t\t\t\t\tclonedOptions.data.design = Runtime.clone(initialOptions.data.design);\n\t\t\t\t\t\t\treturn clonedOptions;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn currentOptions;\n\t\t\t\t\t})();\n\n\t\t\t\t\tif (\n\t\t\t\t\t\toptions.data.recaptcha.use\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!this.getFormDictionary().captcha.hasKeys\n\t\t\t\t\t\t\t&& !options.captcha.hasDefaults\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\toptions.data.recaptcha.use = false;\n\n\t\t\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\t\t\tconst alert: MessageBox = new rootWindow.BX.UI.Dialogs.MessageBox({\n\t\t\t\t\t\t\ttitle: Loc.getMessage('LANDING_FORM_SAVE_CAPTCHA_ALERT_TITLE'),\n\t\t\t\t\t\t\tmessage: Loc.getMessage('LANDING_FORM_SAVE_CAPTCHA_ALERT_TEXT_2'),\n\t\t\t\t\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\t\t\t\t\tonOk: () => {\n\t\t\t\t\t\t\t\talert.close();\n\t\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\talert.show();\n\t\t\t\t\t}\n\n\t\t\t\t\tvoid FormClient.getInstance()\n\t\t\t\t\t\t.saveOptions(options)\n\t\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\t\tthis.setFormOptions(result);\n\t\t\t\t\t\t\tthis.setInitialFormOptions(result);\n\t\t\t\t\t\t\tFormClient.getInstance().resetCache(result.id);\n\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\n\t\t\t\t\t\t\tconst activeButton = this.getSidebarButtons().find((button) => {\n\t\t\t\t\t\t\t\treturn button.isActive();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tactiveButton\n\t\t\t\t\t\t\t\t&& !Dom.hasClass(this.layout, 'landing-ui-panel-mode-transparent')\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tactiveButton.getLayout().click();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.isCrmFormPage())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tDom.addClass(this.getSaveButton().layout, 'ui-btn-icon-done');\n\t\t\t\t\t\t\t\tconst currentButtonText = this.getSaveButton().layout.innerText;\n\t\t\t\t\t\t\t\tthis.getSaveButton().setText(Loc.getMessage('LANDING_FORM_EDITOR_SAVE_BUTTON_STATE_SAVED'));\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-icon-done');\n\t\t\t\t\t\t\t\t\tthis.getSaveButton().setText(currentButtonText);\n\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvoid this.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((errors) => {\n\t\t\t\t\t\t\tif (Type.isArrayFilled(errors))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst errorMessage = errors\n\t\t\t\t\t\t\t\t\t.map((item) => {\n\t\t\t\t\t\t\t\t\t\treturn Text.encode(item.message);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.join('<br><br>');\n\n\t\t\t\t\t\t\t\tconst errorAlert = this.getErrorAlert();\n\t\t\t\t\t\t\t\terrorAlert.setMessage(errorMessage);\n\t\t\t\t\t\t\t\terrorAlert.show();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst rootWindow = PageObject.getRootWindow();\n\t\t\t\t\t\t\t\trootWindow.BX.UI.Dialogs.MessageBox.alert(\n\t\t\t\t\t\t\t\t\tLoc.getMessage('LANDING_FORM_SAVE_UNKNOWN_ERROR_ALERT_TEXT'),\n\t\t\t\t\t\t\t\t\tLoc.getMessage('LANDING_FORM_SAVE_ERROR_ALERT_TITLE'),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (this.useBlockDesign() && this.isCrmFormPage())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.disableUseBlockDesign();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.getSaveButton().layout, 'ui-btn-wait');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tisChanged(): boolean\n\t{\n\t\treturn JSON.stringify(this.getFormOptions()) !== JSON.stringify(this.getInitialFormOptions());\n\t}\n\n\tdisableUseBlockDesign()\n\t{\n\t\tDom.attr(this.getFormNode(), 'data-b24form-use-style', 'N');\n\t\tthis.cache.set('useBlockDesign', false);\n\n\t\tBackend\n\t\t\t.getInstance()\n\t\t\t.action(\n\t\t\t\t'Landing\\\\Block::updateNodes',\n\t\t\t\t{\n\t\t\t\t\tblock: this.getCurrentBlock().id,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'.bitrix24forms': {\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t'data-b24form-use-style': 'N',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tlid: this.getCurrentBlock().lid,\n\t\t\t\t\tsiteId: this.getCurrentBlock().siteId,\n\t\t\t\t},\n\t\t\t\t{code: this.getCurrentBlock().manifest.code},\n\t\t\t);\n\t}\n\n\tonCancelClick()\n\t{\n\t\tconst initialFormOptions = this.getInitialFormOptions();\n\t\tthis.getCrmForm().adjust(initialFormOptions.data);\n\t\tBX.Landing.UI.Panel.Top\n\t\t\t.getInstance()\n\t\t\t.setFormName(initialFormOptions.name);\n\n\t\tvoid this.hide();\n\t}\n\n\thide(): Promise<*>\n\t{\n\t\tconst editorWindow = PageObject.getEditorWindow();\n\t\tDom.removeClass(editorWindow.document.body, 'landing-ui-hide-action-panels-form');\n\t\treturn super.hide();\n\t}\n}\n"],"names":["FormSettingsPanel","rootWindow","PageObject","getRootWindow","rootWindowPanel","BX","Landing","UI","Panel","instance","setEventNamespace","setTitle","Loc","getMessage","lsCache","Cache","LocalStorageCache","disableOverlay","isCrmFormPage","dictionary","Env","getInstance","getOptions","formEditorData","preparedSidebarButtons","sidebarButtons","map","buttonOptions","SidebarButton","child","setSidebarButtons","preparedPresets","scenarios","presetOptions","Preset","setPresets","preparedPresetCategories","scenarioCategories","categoryOptions","PresetCategory","setCategories","Dom","append","getBlockSettingsButton","render","getRightHeaderControls","subscribe","onCancelClick","bind","getExpertSwitcherLayout","layout","cache","remember","onClick","getExpertModeSwitcher","node","click","Tag","switcher","Switcher","checked","isExpertModeEnabled","addClass","Event","onExpertSwitcherClick","set","isChecked","onExpertModeChange","getFormOptions","templateId","preset","getPresets","find","currentPreset","options","id","getCurrentPreset","Type","isArrayFilled","expertModeItems","clearSidebar","getSidebarButtons","filter","button","includes","forEach","items","deactivate","appendSidebarButton","currentSidebarButton","isActive","buttons","defaultSection","isStringFilled","defaultSectionButton","getLayout","get","specialType","Button","text","color","Color","LIGHT_BORDER","round","className","onclick","onFormDesignButtonClick","onBlockSettingsButtonClick","getCurrentBlock","hide","then","showContentPanel","onFormDesignClick","Loader","target","body","getLoader","show","sidebar","content","removeClass","showWithOptions","editorData","setCrmFields","crmFields","setCrmCompanies","crmCompanies","setCrmCategories","crmCategories","setAgreements","agreements","currentOptions","Runtime","clone","formOptions","use","data","setFormOptions","setFormDictionary","Promise","resolve","crmData","Backend","batch","action","result","FormClient","getCurrentFormId","formDictionary","getDictionary","all","orderBy","getFormDictionary","document","lead","enabled","block","alert","Alert","AlertColor","WARNING","parentNode","enableToggleMode","isFormCreated","disableTransparentMode","mainOptions","saveOriginalFileName","prependContent","getSaveOriginalFileNameAlert","closeButtonTop","Text","toNumber","style","closeButton","alertHeight","getBoundingClientRect","height","setCurrentBlock","setCurrentFormId","formId","setCurrentFormInstanceId","instanceId","showLoader","load","hideLoader","isPlainObject","merge","state","presetFromRequest","getPresetIdFromRequest","item","applyPreset","onPresetFieldClick","activatePreset","setInitialFormOptions","catch","error","accessDeniedCode","isAccessDenied","some","errorItem","String","code","footer","getAccessError","console","editorWindow","getEditorWindow","StylePanel","setTimeout","scrollIntoView","behavior","uri","Uri","window","top","location","href","getQueryParam","toBoolean","fields","companies","categories","formApp","Reflection","getClass","getCurrentFormInstanceId","tmpIndex","currentFormIndex","parentElement","childNodes","reduce","acc","attr","list","event","eventData","getData","eventTargetValue","getTarget","getValue","value","skipPrepare","Reflect","has","additionalValue","payment","mergedOptions","responsible","users","recaptcha","key","secret","captcha","isNil","prepareOptions","integration","field","index","Top","setFormName","name","getCrmForm","adjust","personalization","properties","currentButton","extension","contentExtension","loadExtension","exports","default","ContentWrapperClass","isFunction","getCrmFields","getCrmCompanies","getCrmCategories","getAgreements","isLeadEnabled","form","openable","toString","removeQueryParam","history","replaceState","title","Dialogs","MessageBox","MessageBoxButtons","OK_CANCEL","skipOptions","lastPreset","hasClass","runAction","actions","guide","Tour","Guide","onEvents","steps","start","Helper","check","success","checkActionConfirm","getCheckActionConfirm","message","setMessage","description","setOkCaption","confirmButton","setCancelCaption","cancelButton","setOkCallback","getOkButton","setDisabled","getCancelButton","close","setCancelCallback","actionsResult","activate","FieldsPanel","enableTransparentMode","querySelector","getFormNode","scheme","schemeItem","schemes","checkFields","notSynchronizedFields","onOk","messageBox","onCancel","messageDescription","entityName","replace","encode","getCurrentCrmEntityName","messageText","length","lastField","pop","join","confirm","errors","OK","popupOptions","maxHeight","permissions","edit","getSaveButton","getNotSynchronizedFields","sync","showSynchronizationErrorPopup","fieldLabels","label","showSynchronizationPopup","isConfirmed","initialOptions","getInitialFormOptions","clonedOptions","design","hasKeys","hasDefaults","saveOptions","resetCache","activeButton","currentButtonText","innerText","setText","errorMessage","errorAlert","getErrorAlert","useBlockDesign","disableUseBlockDesign","JSON","stringify","attrs","lid","siteId","manifest","initialFormOptions","decode","BasePresetPanel"],"mappings":"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"}